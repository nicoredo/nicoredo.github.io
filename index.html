<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MedEx - Evaluador de Pacientes</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrapper">
    <!-- SecciÃ³n superior: Historia clÃ­nica -->
    <section id="seccion-texto" class="fade-in slide-up">
      <h1>ğŸ©º EvaluaciÃ³n Inteligente de Pacientes</h1>
      <textarea id="texto-hc" placeholder="Pegue aquÃ­ la historia clÃ­nica completa..."></textarea>
      <button id="evaluar-ia-directa" class="btn-principal">ğŸ§  Evaluar con IA</button>
    </section>
<div id="overlay-cargando" class="overlay oculto">
  <div class="contenedor-carga">
    <div class="barra-cargando">
      <div class="progreso"></div>
    </div>
    <p id="frase-carga">Evaluando historia clÃ­nica...</p>
  </div>
</div>


    <!-- SecciÃ³n inferior: InterpretaciÃ³n IA + Acciones -->
    <div class="seccion-inferior">
      <section id="interpretacion-ia" class="tarjeta sombra slide-left">
        <h2>ğŸ“Š InterpretaciÃ³n de la IA</h2>
        <div id="resultado-ia" class="resultado-html">
          <p><em>Esperando evaluaciÃ³n...</em></p>
        </div>
      </section>

      <section id="acciones-finales" class="tarjeta sombra slide-right">
        <h2>ğŸ”§ Acciones</h2>
        <button id="btn-derivar" class="btn-accion">ğŸ“„ Generar DerivaciÃ³n</button>
        <button id="btn-ver-resumen" class="btn-accion">ğŸ—² Ver Resumen</button>
        <button id="btn-limpiar" class="btn-accion btn-secundario">ğŸ—‘ï¸ Limpiar Todo</button>
      </section>
    </div>
  </div>

  <script>
    document.getElementById('evaluar-ia-directa').addEventListener('click', async () => {
      const textoLibre = document.getElementById('texto-hc').value.trim();
      if (!textoLibre) {
        alert('Pegue el texto de la historia clÃ­nica para evaluaciÃ³n IA');
        return;
      }

      const contenedor = document.getElementById("resultado-ia");
      contenedor.innerHTML = '<p><em>Evaluando...</em></p>';

      try {
        const response = await fetch("https://medex-backend.onrender.com/evaluar_ia", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ datos: { texto_hc: textoLibre } })
        });

        const data = await response.json();
        const html = data.resumen_html || "<p>No se obtuvo respuesta</p>";

        // Enriquecimiento visual
        const enriquecido = html
          .replaceAll("âœ…", "<span class='tag cumple'>âœ…</span>")
          .replaceAll("âš ï¸", "<span class='tag parcial'>âš ï¸</span>")
          .replaceAll("âŒ", "<span class='tag excluido'>âŒ</span>");

        contenedor.innerHTML = `<div class="bloque">${enriquecido}</div>`;

      } catch (error) {
        console.error("Error evaluando IA directa:", error);
        contenedor.innerHTML = '<p class="excluido">Error al consultar la IA</p>';
      }
    });
  </script>
</body>
</html>
